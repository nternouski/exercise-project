(()=>{"use strict";var e={38:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,s)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.api=void 0;const i=n(r(860)),c=a(r(744)),u=(0,i.default)();u.disable("x-powered-by");const l=r(528),d=r(109);u.use(l.tokenAuth,d.logHandler),u.get("/api/user",((e,t)=>t.status(200).json({userId:e.locals.userId})));const p=r(822);u.use("/api/tasks",p.listener);const f=r(695);u.use(f.errorHandler),t.api=c.runWith({memory:"512MB",timeoutSeconds:60}).https.onRequest(u)},528:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tokenAuth=t.Locals=void 0;const o=r(509),s=r(695);t.Locals=class{},t.tokenAuth=async(e,t,r)=>{try{const t=await(0,o.auth)().verifyIdToken(e.headers.authorization||"");console.log(`${t.provider_id} | ${t.uid}`);const s={...e.locals,userId:t.uid};e.locals=s,r()}catch(e){r(new s.ApplicationError({error:"Invalid Token",err:e},"Invalid Token",401))}}},695:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandler=t.ApplicationError=void 0;class r extends Error{constructor(e,t="Ha ocurrido un error",r=500,o="unexpectedError"){var s;super(t),this.httpStatusCode=r,this.eventType=o;const a=(null===(s=null==e?void 0:e.error)||void 0===s?void 0:s.stack)||(null==e?void 0:e.stack);this.json=JSON.stringify({...e,stack:a,publicMessage:t})}}t.ApplicationError=r;const o=e=>"string"==typeof e?new r({error:e,message:`unexpected error (string) -- ${e}`}):e instanceof r?e:new r({error:e,message:`unexpected error -- ${e.name}: ${e.message}`});t.errorHandler=async(e,t,s,a)=>{let n;if(Array.isArray(e))if(e.length>1){const t=e.map(o).map((e=>e.message)).join("//");n=new r({error:t})}else n=1===e.length?o(e[0]):new r({error:"empty error array"});else n=o(e);try{s.status(n.httpStatusCode).json({message:n.message})}catch(e){try{s.end()}catch(t){console.log("request ended before error"),console.error(e,t)}}}},109:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logHandler=void 0,t.logHandler=async(e,t,r)=>{const o=e.get("x-original-url")||e.originalUrl;console.log(`${e.method} | ${o}`),r()}},822:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.listener=void 0;const o=r(860),s=r(611),a=r(383),n=(0,o.Router)();n.get(":id",(async(e,t,r)=>{try{const r=e.params.id,o=await(0,s.getDocument)((0,a.getTaskPath)(r));t.status(200).json({task:o})}catch(e){r(e)}})),n.post("",(async(e,t,r)=>{try{const r=e.body.task;return r.userId!==e.locals.userId?t.status(401).json({success:!1}):(await(0,s.createDocPath)((0,a.getTaskCollection)(),r),t.status(201).json({success:!0}))}catch(e){return r(e)}})),n.patch(":id",(async(e,t,r)=>{try{const r=e.params.id,o=await(0,s.getDocument)((0,a.getTaskPath)(r));return o.userId!==e.locals.userId?t.status(401).json({success:!1}):(await(0,s.updateDoc)((0,a.getTaskPath)(o.id),o,!0),t.status(200).json({success:!0}))}catch(e){return r(e)}})),n.delete(":id",(async(e,t,r)=>{try{const r=e.params.id,o=await(0,s.getDocument)((0,a.getTaskPath)(r));return o.userId!==e.locals.userId?t.status(401).json({success:!1}):(await(0,s.updateDoc)((0,a.getTaskPath)(o.id),{isActive:!1},!0),t.status(200).json({success:!0}))}catch(e){return r(e)}})),t.listener=n},607:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,s)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t},n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(411),a(r(509)).initializeApp(),n(r(38),t)},611:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAuthUser=t.updateDoc=t.createDocPath=t.getNewDocumentRef=t.getDocumentRef=t.getDocument=t.getDocuments=t.docExists=t.projectId=void 0;const o=r(509),s=r(695),a=(0,o.firestore)();t.projectId=process.env.GCP_PROJECT||process.env.GCLOUD_PROJECT||(0,o.installations)().app.options.projectId||"",t.docExists=async e=>(await(0,t.getDocumentRef)(e).get()).exists,t.getDocuments=async(e,t=[])=>{let r=a.collection(e);return t.map((e=>{const[t,o,s]=e;r=r.where(t,o,s)})),(await r.get()).docs.map((e=>Object.assign(e.data(),{id:e.id})))},t.getDocument=async e=>{const t=await a.doc(e).get();if(t.exists)return Object.assign(t.data(),{id:t.id});throw new s.ApplicationError({error:`no document found: ${e}`})},t.getDocumentRef=e=>a.doc(e),t.getNewDocumentRef=e=>a.collection(e).doc(),t.createDocPath=(e,t)=>a.collection(e).add(t),t.updateDoc=async(e,t,r)=>{const o=await a.doc(e).get();return o.exists||r?o.ref.set({...o.data(),...t},{merge:r}):Promise.resolve()},t.getAuthUser=async e=>(0,o.auth)().getUser(e)},301:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.path=t.BaseObject=void 0,t.BaseObject=class{constructor(){this.isActive=!0,this.timestamp=new Date}},t.path={join:(...e)=>e.map((e=>e.trim().replace(/(^[\/]*|[\/]*$)/g,""))).filter((e=>e.length>0)).join("/")}},383:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,s)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(301),t),s(r(449),t)},449:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTaskPath=t.getTaskCollection=t.taskCollectionGroup=t.Task=void 0;const o=r(301);class s extends o.BaseObject{}t.Task=s,t.taskCollectionGroup="tasks",t.getTaskCollection=()=>o.path.join(t.taskCollectionGroup),t.getTaskPath=e=>o.path.join((0,t.getTaskCollection)(),e)},860:e=>{e.exports=require("express")},509:e=>{e.exports=require("firebase-admin")},744:e=>{e.exports=require("firebase-functions")},411:e=>{e.exports=require("node:path")}},t={},r=function r(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,r),a.exports}(607);for(var o in r)this[o]=r[o];r.__esModule&&Object.defineProperty(this,"__esModule",{value:!0})})();